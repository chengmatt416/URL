<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Matt's URL Shortener & File Downloader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... (your previous styles) ... */
    .download-section {
      margin-top: 2em;
      padding: 1.3em 1em 1em 1em;
      background: #eaf6ff;
      border-radius: 1em;
      box-shadow: 0 3px 12px #2987eb14;
    }
    body.dark .download-section {
      background: #1b2838;
      color: #cfeaff;
    }
    .download-table th, .download-table td {
      padding: 0.6em 0.2em;
      border-bottom: 1px solid #e0e7ef;
    }
    .download-table th {
      background: #c3e5ff;
      color: #1b2838;
    }
    body.dark .download-table th {
      background: #232a3a;
      color: #ffdc4f;
    }
    .download-btn {
      background: #2987eb;
      color: #fff;
      padding: 0.35em 1em;
      border: none;
      border-radius: 0.8em;
      cursor: pointer;
      font-size: 1em;
      margin-left: 0.2em;
      transition: background 0.2s;
    }
    .download-btn:active { background: #1558b2; }
    .file-link {
      color: #1558b2;
      text-decoration: underline;
      word-break: break-all;
    }
    body.dark .file-link {
      color: #ffdc4f;
    }
    .download-searchbar {
      width: 100%;
      padding: 0.5em 1em;
      font-size: 1em;
      margin-bottom: 0.7em;
      border-radius: 1em;
      border: 1px solid #ccc;
      background: #fafbff;
      box-sizing: border-box;
      transition: border 0.3s;
    }
    body.dark .download-searchbar {
      background: #222c3a;
      color: #fff;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ... (your previous content) ... -->

    <!-- File Download Section -->
    <div class="download-section">
      <h2>üìÅ File Download Section (OneDrive)</h2>
      <input class="download-searchbar" id="fileSearch" type="text" placeholder="ÊêúÂ∞ãÊ™îÊ°àÁü≠Á¢ºÊàñ‰∏ãËºâÈÄ£Áµê..." autocomplete="off">
      <table class="download-table" id="fileTable">
        <thead>
          <tr>
            <th>Ê™îÊ°àÁü≠Á¢º</th>
            <th>‰∏ãËºâÈÄ£Áµê</th>
            <th>Êìç‰Ωú</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="3" style="text-align:center;color:#aaa;">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <script>
    // ... (your previous script code for dark mode and short URLs) ...

    // --- File Download Section ---
    const repoPath = window.location.pathname.split('/')[1] || 'URL';
    const filesJsonUrl = `/${repoPath}/files.json`;
    const fileTableBody = document.querySelector('#fileTable tbody');
    let fileMap = {}, fileRows = [];
    function renderFileTable(filter='') {
      let rows = Object.entries(fileMap)
        .filter(([k,v]) => k.includes(filter) || v.includes(filter))
        .map(([key, fileUrl]) => {
          return `<tr>
            <td><span class="badge">${key}</span></td>
            <td><a class="file-link" href="${fileUrl}" target="_blank">${fileUrl}</a></td>
            <td>
              <button class="download-btn" onclick="downloadFile('${fileUrl}')">Download</button>
              <button class="copy-btn" onclick="copyToClipboard('${fileUrl}', this)">Copy Link</button>
            </td>
          </tr>`;
        });
      fileTableBody.innerHTML = rows.length ? rows.join('') : `<tr><td colspan="3" style="text-align:center;color:#aaa;">No results</td></tr>`;
      fileRows = rows;
    }
    fetch(filesJsonUrl)
      .then(r => r.json())
      .then(j => { fileMap = j; renderFileTable(); })
      .catch(() => { fileTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#e34;">Failed to load files.json</td></tr>`; });
    document.getElementById('fileSearch').oninput = function() {
      renderFileTable(this.value.trim());
    };
    window.downloadFile = function(url) {
      // This will open the file in a new tab and should trigger download if OneDrive allows it
      window.open(url, "_blank");
    };
    window.copyToClipboard = function(txt, btn) {
      navigator.clipboard.writeText(txt);
      btn.textContent = "Copied!";
      setTimeout(()=>{btn.textContent="Copy Link";}, 1200);
    };
  </script>
</body>
</html>
